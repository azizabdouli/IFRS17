<!-- angular-frontend/src/app/components/dashboard/ppna-upload.component.html -->

<div class="ppna-upload-container mt-4">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="fas fa-file-excel text-success me-2"></i>
        Fichier PPNA Excel
      </h5>
      <span class="badge" [ngClass]="getApprocheBadgeClass()">
        Approche PAA IFRS17
      </span>
    </div>
    
    <div class="card-body">
      <!-- Zone d'upload -->
      <div class="upload-zone mb-3" 
           [class.dragover]="isDragOver"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onDrop($event)"
           (click)="fileInput.click()">
        
        <div class="text-center p-4">
          <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
          <h6>Glissez-déposez votre fichier PPNA ici</h6>
          <p class="text-muted small">ou cliquez pour sélectionner un fichier</p>
          <p class="text-muted small">
            <i class="fas fa-info-circle me-1"></i>
            Formats acceptés: .xlsx, .xls (max 50MB)
          </p>
        </div>
        
        <input #fileInput
               type="file"
               accept=".xlsx,.xls"
               (change)="onFileSelected($event)"
               style="display: none;">
      </div>

      <!-- Fichier sélectionné -->
      <div *ngIf="selectedFile" class="selected-file-info mb-3">
        <div class="alert alert-info d-flex align-items-center">
          <i class="fas fa-file-excel text-success me-2"></i>
          <div class="flex-grow-1">
            <strong>{{ selectedFile.name }}</strong>
            <small class="d-block text-muted">
              {{ formatFileSize(selectedFile.size) }} - 
              {{ selectedFile.lastModified | date:'dd/MM/yyyy HH:mm' }}
            </small>
          </div>
          <button class="btn btn-sm btn-outline-danger"
                  (click)="clearFile()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Boutons d'action -->
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <button class="btn btn-primary me-2"
                  [disabled]="!selectedFile || isUploading"
                  (click)="uploadFile()">
            <i class="fas fa-upload me-1"></i>
            <span *ngIf="!isUploading">Traiter le fichier</span>
            <span *ngIf="isUploading">
              <span class="spinner-border spinner-border-sm me-1"></span>
              Traitement...
            </span>
          </button>
          
          <button class="btn btn-outline-secondary"
                  [disabled]="isUploading"
                  (click)="loadCurrentData()">
            <i class="fas fa-refresh me-1"></i>
            Recharger les données
          </button>
        </div>

        <!-- Indicateur de statut -->
        <div *ngIf="isPPNADataLoaded()" class="text-success">
          <i class="fas fa-check-circle me-1"></i>
          Données PPNA chargées
        </div>
      </div>

      <!-- Barre de progression -->
      <div *ngIf="uploadProgress > 0" class="progress mt-3">
        <div class="progress-bar progress-bar-striped progress-bar-animated"
             [style.width.%]="uploadProgress">
          {{ uploadProgress }}%
        </div>
      </div>

      <!-- Messages de feedback -->
      <div *ngIf="uploadMessage" class="mt-3">
        <div class="alert" 
             [ngClass]="{
               'alert-success': uploadMessage.type === 'success',
               'alert-danger': uploadMessage.type === 'error',
               'alert-warning': uploadMessage.type === 'warning',
               'alert-info': uploadMessage.type === 'info'
             }">
          <i class="fas" 
             [ngClass]="{
               'fa-check-circle': uploadMessage.type === 'success',
               'fa-exclamation-triangle': uploadMessage.type === 'error' || uploadMessage.type === 'warning',
               'fa-info-circle': uploadMessage.type === 'info'
             }" 
             class="me-2"></i>
          {{ uploadMessage.text }}
        </div>
      </div>
    </div>
  </div>

  <!-- Informations sur le fichier actuel -->
  <div *ngIf="isPPNADataLoaded()" class="card mt-3">
    <div class="card-header">
      <h6 class="mb-0">
        <i class="fas fa-chart-bar text-primary me-2"></i>
        Informations sur les données PPNA
      </h6>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <div class="metric-item">
            <label>LRC Total (PAA):</label>
            <span class="value">{{ formatCurrency(ppnaMetrics?.lrc_total || 0) }}</span>
          </div>
          <div class="metric-item">
            <label>PPNA Total:</label>
            <span class="value">{{ formatCurrency(ppnaMetrics?.ppna_total || 0) }}</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="metric-item">
            <label>Risk Adjustment:</label>
            <span class="value">{{ formatCurrency(ppnaMetrics?.risk_adjustment || 0) }}</span>
          </div>
          <div class="metric-item">
            <label>Contrats Onéreux:</label>
            <span class="badge" [ngClass]="getContratOnereuxSeverity()">
              {{ ppnaMetrics?.contrats_onereux || 0 }}
            </span>
          </div>
        </div>
      </div>
      
      <div class="mt-3">
        <small class="text-muted">
          <i class="fas fa-clock me-1"></i>
          Dernière mise à jour: {{ ppnaMetrics?.derniere_maj | date:'dd/MM/yyyy HH:mm:ss' }}
        </small>
      </div>
    </div>
  </div>
</div>

<style>
.ppna-upload-container {
  max-width: 800px;
}

.upload-zone {
  border: 2px dashed #dee2e6;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.upload-zone:hover {
  border-color: #007bff;
  background-color: rgba(0, 123, 255, 0.05);
}

.upload-zone.dragover {
  border-color: #28a745;
  background-color: rgba(40, 167, 69, 0.1);
}

.metric-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  padding: 0.25rem 0;
  border-bottom: 1px solid #f8f9fa;
}

.metric-item label {
  font-weight: 500;
  color: #6c757d;
}

.metric-item .value {
  font-weight: 600;
  color: #495057;
}

.badge-success {
  background-color: #28a745;
}

.badge-secondary {
  background-color: #6c757d;
}

.badge-warning {
  background-color: #ffc107;
  color: #212529;
}

.badge-danger {
  background-color: #dc3545;
}
</style>